import{Ka as M,aa as _,ca as U,oa as D,sc as $,va as N}from"./chunk-ZLLPVL2Z.js";import{Cd as v,Fb as f,Lb as h,Ma as g,Sb as i,ec as l,fc as y,gc as c,he as T,nc as I,pc as C,sb as p,ud as z,we as r,xb as u}from"./chunk-MKYLPF5H.js";function E(o,t){if(o&1&&c(0,"i",4),o&2){let e=C();i("title",e.$t("_upload"))}}function R(o,t){o&1&&c(0,"i",5),o&2&&i("nzType","loading")}var S=class o{constructor(t){this.message=t}accept="image/*";onChange=new g;$t=r;uploading=!1;id=`f${Date.now()}${parseInt(Math.random()*1e6)}`;onChangeFile(t){if(this.uploading)return;let{files:e}=t.target;if(e.length<=0)return;let n=e[0];if(!n.type.startsWith("image"))return this.message.error(r("_notUpload"));this.onUpload(n).finally(()=>{t.target.value=""})}onUpload(t){let e=this;return new Promise((n,s)=>{let a=new FileReader;a.readAsDataURL(t),a.onerror=s,a.onload=function(){e.uploading=!0;let b=this.result.split(",")[1],w=`.${t.name.split(".").at(-1)||"png"}`,m=`${Date.now()}${w}`;N({branch:D().branch,message:"create image",content:b,isEncode:!1,path:m}).then(F=>{let d={cdn:T?F?.data?.fullImagePath:M(m)};e.onChange.emit(d),e.message.success(r("_uploadSuccess")),n(d)}).catch(s).finally(()=>{e.uploading=!1})}})}static \u0275fac=function(e){return new(e||o)(u($))};static \u0275cmp=f({type:o,selectors:[["app-upload-image"]],inputs:{accept:"accept"},outputs:{onChange:"onChange"},decls:4,vars:5,consts:[[3,"id"],["nz-icon","","nzType","upload","nzTheme","outline","class","cursor-pointer",3,"title",4,"ngIf"],["nz-icon","",3,"nzType",4,"ngIf"],["type","file",1,"!hidden",3,"change","name","accept"],["nz-icon","","nzType","upload","nzTheme","outline",1,"cursor-pointer",3,"title"],["nz-icon","",3,"nzType"]],template:function(e,n){e&1&&(l(0,"label",0),h(1,E,1,1,"i",1)(2,R,1,1,"i",2),l(3,"input",3),I("change",function(a){return n.onChangeFile(a)}),y()()),e&2&&(i("id",n.id),p(),i("ngIf",!n.uploading),p(),i("ngIf",n.uploading),p(),i("name",n.id)("accept",n.accept))},dependencies:[v,z,U,_],encapsulation:2})};export{S as a};
